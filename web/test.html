<!doctype html>
<html>
  <head>
    <script src="./object_explorer.js"></script>
  </head>
  <body>
    <div id="drop-area" style="background-color: #cccccc; height: 200px;">Drop your file here</div>

    <script>

Module.onRuntimeInitialized = function() {
  _run_example();
};


function passFileToEmscripten( file ) {
  return new Promise( (resolve, reject) => {
    var arrayBuffer;
    var fileReader = new FileReader();
    fileReader.onload = function(event) {
        arrayBuffer = event.target.result;
    };
    fileReader.onloadend = function () {
        arr = new Uint8Array( arrayBuffer );
        emAddr = allocate( arr,  'i8', ALLOC_NORMAL );
        resolve( [ emAddr, arr.length ] );
    };
    fileReader.readAsArrayBuffer( file );
  } );
}



document.getElementById( 'drop-area' ).addEventListener( 'dragover', ev => {
  ev.stopPropagation();
  ev.preventDefault();
});

document.getElementById( 'drop-area' ).addEventListener( 'drop', function( ev ) {
  ev.stopPropagation();
  ev.preventDefault();
  window.ev = ev;

  if ( ev.dataTransfer.items.length != 1 ) {
    console.error( 'Can drop one file only' );
    return;
  }

  let item = ev.dataTransfer.items[0];

  if ( item.kind != 'file' ) {
    console.error( 'Dropped item must be a file' );
    return;
  }

  passFileToEmscripten( item.getAsFile() ).then( ( [addr, len] ) => {
    Module.ccall( 'run_with_buffer', 'number', ['number', 'number'], [addr, len] )
  } );

});

    </script>
  </body>
</html>
